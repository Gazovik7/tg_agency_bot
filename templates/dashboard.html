<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –¢–µ—Å—Ç–æ–≤–æ–µ –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ</title>
    
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <div class="dashboard-header">
            <div>
                <h1 class="dashboard-title">üìä –ê–Ω–∞–ª–∏—Ç–∏–∫–∞ –¢–µ—Å—Ç–æ–≤–æ–µ –ê–≥–µ–Ω—Ç—Å—Ç–≤–æ</h1>
                <p class="dashboard-subtitle">–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏</p>
            </div>
            <div>
                <span class="badge bg-primary" id="currentPeriod">–ü–µ—Ä–∏–æ–¥: 2025-05-01 - 2025-05-25</span>
            </div>
        </div>

        <div class="card">
            <div class="card-header">
                <h2 class="card-title">–§–∏–ª—å—Ç—Ä—ã</h2>
            </div>
            <div class="card-body">
                <form id="filtersForm" class="filters-container">
                    <div class="form-group">
                        <label for="chatFilter" class="form-label">–ß–∞—Ç:</label>
                        <select class="form-select" id="chatFilter" name="chat_id">
                            <option value="">–í—Å–µ —á–∞—Ç—ã</option>
                            <!-- Options will be populated via JavaScript -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="employeeFilter" class="form-label">–°–æ—Ç—Ä—É–¥–Ω–∏–∫:</label>
                        <select class="form-select" id="employeeFilter" name="employee_id">
                            <option value="">–í—Å–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</option>
                            <!-- Options will be populated via JavaScript -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="startDate" class="form-label">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:</label>
                        <input type="date" class="form-control" id="startDate" name="start_date">
                    </div>

                    <div class="form-group">
                        <label for="endDate" class="form-label">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞:</label>
                        <input type="date" class="form-control" id="endDate" name="end_date">
                    </div>

                    <div class="form-group d-flex align-items-end">
                        <button type="submit" class="btn btn-primary">–ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
        <div class="card">
            <div class="card-header">
                <h2 class="card-title">–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
            </div>
            <div class="card-body">
                <div class="grid">
                    <div class="stat-card">
                        <div class="stat-title">–í—Å–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                        <div class="stat-value" id="totalMessagesStats">0</div>
                        <div class="stat-description">–ó–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">–í—Å–µ–≥–æ —Å–∏–º–≤–æ–ª–æ–≤</div>
                        <div class="stat-value" id="totalSymbolsStats">0</div>
                        <div class="stat-description">–û–±—â–∏–π –æ–±—ä–µ–º –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">–°–æ–æ–±—â–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã</div>
                        <div class="stat-value" id="teamMessagesStats">0</div>
                        <div class="stat-description" id="teamMessagesPercent">56% –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">–°–æ–æ–±—â–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                        <div class="stat-value" id="clientMessagesStats">0</div>
                        <div class="stat-description" id="clientMessagesPercent">44% –æ—Ç –æ–±—â–µ–≥–æ —á–∏—Å–ª–∞</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">–°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</div>
                        <div class="stat-value" id="avgResponseStats">0 –º–∏–Ω</div>
                        <div class="stat-description">–í—Ä–µ–º—è —Ä–µ–∞–∫—Ü–∏–∏ –∫–æ–º–∞–Ω–¥—ã</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞</div>
                        <div class="stat-value" id="maxResponseStats">0 –º–∏–Ω</div>
                        <div class="stat-description">–°–∞–º—ã–π –¥–æ–ª–≥–∏–π –æ—Ç–≤–µ—Ç</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- –í–∫–ª–∞–¥–∫–∏ —Å –∞–Ω–∞–ª–∏—Ç–∏–∫–æ–π -->
        <div class="tab-container">
            <ul class="tabs" id="analytics-tabs">
                <li class="tab-item active" data-tab="employees">–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</li>
                <li class="tab-item" data-tab="clients">–ö–ª–∏–µ–Ω—Ç—ã</li>
                <li class="tab-item" data-tab="activity">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å</li>
                <li class="tab-item" data-tab="sentiment">–¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å</li>
                <li class="tab-item" data-tab="communications">–ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏</li>
            </ul>

            <div class="tab-content">
                <!-- –í–∫–ª–∞–¥–∫–∞ –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ -->
                <div class="tab-pane active" id="employees">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="employeeActivityChart"></div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –ö–ª–∏–µ–Ω—Ç—ã -->
                <div class="tab-pane" id="clients">
                    <div class="clients-overview">
                        <!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                        <div class="row mb-4">
                            <div class="col-md-3">
                                <div class="stat-card clients-stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">–ê–∫—Ç–∏–≤–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                                        <div class="stat-value" id="totalActiveClients">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card clients-stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-comments"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">–°–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤</div>
                                        <div class="stat-value" id="totalClientMessages">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card clients-stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">–°—Ä–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç–∞</div>
                                        <div class="stat-value" id="avgMessagesPerClient">0</div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="stat-card clients-stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-font"></i>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-title">–û–±—â–∏–π –æ–±—ä–µ–º —Ç–µ–∫—Å—Ç–∞</div>
                                        <div class="stat-value" id="totalClientCharacters">0</div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                        <div class="row">
                            <div class="col-lg-8">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤</h3>
                                        <div class="chart-controls">
                                            <button class="btn btn-sm btn-outline-primary active" onclick="toggleClientChartType('messages')">–ü–æ —Å–æ–æ–±—â–µ–Ω–∏—è–º</button>
                                            <button class="btn btn-sm btn-outline-primary" onclick="toggleClientChartType('characters')">–ü–æ —Å–∏–º–≤–æ–ª–∞–º</button>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container" id="clientActivityChart"></div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-4">
                                <div class="card">
                                    <div class="card-header">
                                        <h3 class="card-title">–î–æ–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</h3>
                                    </div>
                                    <div class="card-body">
                                        <div class="chart-container" id="clientDistributionChart"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö -->
                        <div class="card mt-4">
                            <div class="card-header">
                                <h3 class="card-title">–î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –∫–ª–∏–µ–Ω—Ç–∞—Ö</h3>
                                <div class="client-view-controls">
                                    <button class="btn btn-sm btn-outline-primary active" onclick="toggleClientView('cards')">
                                        <i class="fas fa-th-large"></i> –ö–∞—Ä—Ç–æ—á–∫–∏
                                    </button>
                                    <button class="btn btn-sm btn-outline-primary" onclick="toggleClientView('table')">
                                        <i class="fas fa-table"></i> –¢–∞–±–ª–∏—Ü–∞
                                    </button>
                                </div>
                            </div>
                            <div class="card-body">
                                <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                                <div id="clientCardsView" class="clients-grid">
                                    <!-- Client cards will be populated here -->
                                </div>

                                <!-- –¢–∞–±–ª–∏—Ü–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤ -->
                                <div id="clientTableView" class="table-container" style="display: none;">
                                    <table class="table table-hover">
                                        <thead>
                                            <tr>
                                                <th>–ö–ª–∏–µ–Ω—Ç</th>
                                                <th>–°–æ–æ–±—â–µ–Ω–∏–π</th>
                                                <th>–°–∏–º–≤–æ–ª–æ–≤</th>
                                                <th>–°—Ä–µ–¥–Ω—è—è –¥–ª–∏–Ω–∞</th>
                                                <th>–î–æ–ª—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏</th>
                                                <th>–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å</th>
                                            </tr>
                                        </thead>
                                        <tbody id="clientsTableBody">
                                            <!-- Client rows will be populated here -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å -->
                <div class="tab-pane" id="activity">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ê–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="activityChart"></div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –¢–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å -->
                <div class="tab-pane" id="sentiment">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–ê–Ω–∞–ª–∏–∑ —Ç–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ —Å–æ–æ–±—â–µ–Ω–∏–π</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="sentimentChart"></div>
                        </div>
                    </div>
                </div>

                <!-- –í–∫–ª–∞–¥–∫–∞ –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏ -->
                <div class="tab-pane" id="communications">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">–û–±–∑–æ—Ä –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–π</h3>
                        </div>
                        <div class="card-body">
                            <div class="chart-container" id="communicationsChart"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JavaScript -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Dashboard JavaScript -->
    <script>
        // Pass admin token to JavaScript
        var adminToken = '{{ admin_token }}';
    </script>
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
